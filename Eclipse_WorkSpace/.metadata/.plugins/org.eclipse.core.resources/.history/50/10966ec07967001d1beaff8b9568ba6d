package MainSystem;

import java.util.ArrayList;
import java.util.Enumeration;
import java.util.InputMismatchException;
import java.util.List;
import java.util.Random;

import Login.SwitchController;
import UserController.LoginUserController;
import UserController.MainSystemUserController;
import UserController.MaintainUserController;
import UserController.SecondaryUserController;
import UserController.UserListController;
import assets.CustomScanner;
import assets.Logo;
import messageHandler.ClearAllMessages;
import messageHandler.ConsoleHandler;
import messageHandler.MessageHandler;

public class AdministrativeFunctions {
    public static List<String>administrativeRequests = new ArrayList<>();
    public static List<String>administrativeRequestKeyWord = new ArrayList<>();
    public static List<String>administrativeRequestUser = new ArrayList<>();
    public static List<String>administrativeRequestedName = new ArrayList<>();
    public static List<String>administrativeRequestFull = new ArrayList<>();
    public static List<Integer>administrativeRequestID = new ArrayList<>();
    public static List<String>accountRequestNamePool = new ArrayList<>();
    public static int requestsMade = 0;
    public static int updateRequestsMade(){
        requestsMade = administrativeRequests.size();
        return requestsMade;
    }

    public static void AdministrativeMenu(){
        updateRequestsMade();
        Logo.displayLogo();
        System.out.println("Welcome to the Solar Administrative Menu User: " + MainSystemUserController.GetProperty("AccountName"));
        System.out.println("[CREATE]:  Create a User");
        System.out.println("[DELETE]:  Delete a User");
        System.out.println("[REQUESTS]: View User Requests; Current Request Count: [" + requestsMade + "]");
        System.out.println("[CHANGE]:  Change a User Pass");
        System.out.println("[ENABLE]:  Enable an Account");
        System.out.println("[PASSFLAG]: Set Passflag for an account");
        System.out.println("[LIST]: List All Registered Users");
        System.out.println("[DISABLE]: Disable a User Account");
        System.out.println("[TAX]: Tax Percentage adjustment; Current Tax Percentage: " + SettingsController.getSetting("TaxP") + "%");
        System.out.println("[CLS]:     Clear Logs");
        System.out.println("[RETURN]:  Return to Main Menu");
        ConsoleHandler.getConsole();
        String option = CustomScanner.nextLine().toLowerCase();
        try{
            if(option.equals("create") && Integer.parseInt(MainSystemUserController.GetProperty("PermissionLevel")) >= 8){
                MaintainUserController.createNewUser("Blank");
                AdministrativeMenu();
            }else if(option.equals("delete") && Integer.parseInt(MainSystemUserController.GetProperty("PermissionLevel")) >= 8){
                System.out.println("User to delete: ");
                String user = CustomScanner.nextLine();
                if(UserListController.SearchForUser(user) == true){
                   MaintainUserController.deleteUser(user);
                }else{
                    MessageHandler.handleMessage(-1, "Unable to find user [" + user + "]", true);
                }
                AdministrativeMenu();
            }else if(option.equals("change") && Integer.parseInt(MainSystemUserController.GetProperty("PermissionLevel")) >= 8){
                System.out.println("Target Account for password change: ");
                String user = CustomScanner.nextLine();
                LoginUserController.adminUpdateUserPass(user);
                AdministrativeMenu();
            }else if(option.equals("requests")){
                resolutionAdvisory();
                AdministrativeMenu();
            }else if(option.equals("tax")){
                System.out.println("Current TaxP: " + SettingsController.getSetting("TaxP") + "%");
                System.out.println("New TaxP: ");
                try{
                    Double TaxP = CustomScanner.nextDouble();
                    SettingsController.setSetting("TaxP", String.valueOf(TaxP));
                    AdministrativeMenu();
                }catch(InputMismatchException e){
                    MessageHandler.handleMessage(-2, e.toString(), true);
                    AdministrativeMenu();
                }
            }else if(option.equals("list")){
            	Logo.displayLogo();
            	System.out.println("Users on List");
            	Logo.displayLine();
            	UserListController.loadUserList();
            	Enumeration keys = UserListController.userlist.keys();
            	while (keys.hasMoreElements()) {
                    String key = (String)keys.nextElement();
                    String value = (String)UserListController.userlist.get(key);
                    System.out.println(key + ": " + value);
                    MessageHandler.handleMessage(1, key + ": " + value, false);
                }
            	String enter = CustomScanner.nextLine();
            	AdministrativeMenu();
            }else if(option.equals("passflag")){
                Logo.displayLogo();
                System.out.println("Target Account: ");
                String Account = CustomScanner.nextLine();
                MessageHandler.handleMessage(1, Account + " was targeted for PassFlag change", false);
                if(UserListController.SearchForUser(Account) == true){
                    LoginUserController.loadUserProperties(Account);
                    LoginUserController.setValue(Account, "PassFlag", "true");
                    MessageHandler.handleMessage(1, "PassFlag set for user: " + MaintainUserController.GetProperty("Username"), true);
                }else{
                    MessageHandler.handleMessage(-1, "Unable to find user [" + Account + "]", true);
                }
                AdministrativeMenu();
            }else if(option.equals("cls")){
                System.out.println("Are you sure you want to delete the logs?");
                String choice = CustomScanner.nextLine().toLowerCase();
                if(choice.equals("y")|| choice.equals("yes")){
                    System.out.println("[WARNING]: This process is not reversible! Would you like to dump Logs into file first?");
                    String Choice = CustomScanner.nextLine().toLowerCase();
                    if(Choice.equals("yes") || Choice.equals("y")){
                        MessageHandler.dumpAll();
                        ClearAllMessages.clearAll();
                        AdministrativeMenu();
                    }else{
                        ClearAllMessages.clearAll();
                        AdministrativeMenu();
                    }
                }else{
                    MessageHandler.handleMessage(-1, "User did not erase logs", true);
                    AdministrativeMenu();
                }
            }else if(option.equals("disable")){
                disableAnAccount(); 
                AdministrativeMenu();
            }else if(option.equals("enable")){
                enableAnAccount();
                AdministrativeMenu();
            }else if(option.equals("return")){
                MainMenu.mainMenu();
            }else{
                if(Integer.parseInt(MaintainUserController.GetProperty("PermissionLevel")) >= 8){
                    MessageHandler.handleMessage(-1, "Invalid option, try again!", true);
                }else{
                    MessageHandler.handleMessage(-1, SwitchController.focusUser + " does not have the proper permissions for this function. Please return to Main Menu!", true);
                }
                AdministrativeMenu();
            }
        }catch(NumberFormatException e){
            MessageHandler.handleMessage(-2, e.toString() + " [E1T0]", true);
            MessageHandler.handleMessage(-1, "An Error Occured with the Administrative Menu... Reloading Menu", true);
            AdministrativeMenu();
        }
    }

    public static boolean resolutionAdvisory() {
        if(updateRequestsMade() == 0){
            MessageHandler.handleMessage(-1, "No Requests have been made", true);
            return false;
        }
        Logo.displayLogo();
        System.out.println("Resolution Advisory");
        Logo.displayLine();
        int size = updateRequestsMade();
        MessageHandler.handleMessage(1, "Current Requests: ", false);
        for(int i = 0; i < administrativeRequests.size(); i++){
            System.out.println(size + ". " + administrativeRequests.get(i));
            MessageHandler.handleMessage(1, size + ". " + administrativeRequests.get(i) + "[" + administrativeRequestID.get(i) + "]", false);
        }
        try{
            int option = CustomScanner.nextInt();
            option--;
            Logo.displayLogo();
            System.out.println("Account Name: ");
            Logo.displayLine();
            System.out.println(size + ". " + administrativeRequests.get(option));
            String user = CustomScanner.nextLine();
            if(administrativeRequestKeyWord.get(option).contains("Permissions")){
                SecondaryUserController.adjPermLev(user);
                administrativeRequests.remove(option);
                administrativeRequestFull.remove(option);
                administrativeRequestID.remove(option);
                administrativeRequestKeyWord.remove(option);
                administrativeRequestUser.remove(option);   
                administrativeRequestedName.remove(option);
            }else if(administrativeRequestKeyWord.get(option).contains("new Account")){
                MaintainUserController.createNewUser(administrativeRequestedName.get(option));
                administrativeRequests.remove(option);
                administrativeRequestFull.remove(option);
                administrativeRequestID.remove(option);
                administrativeRequestKeyWord.remove(option);
                administrativeRequestUser.remove(option); 
                administrativeRequestedName.remove(option);
                AdministrativeMenu();
            }else if(administrativeRequestKeyWord.get(option).contains("Change Account Name")){
                System.out.println("Target Username: ");
                String User = administrativeRequestUser.get(option);
                System.out.println(user);
                System.out.println("New Account Name: ");
                String AccountName = administrativeRequestedName.get(option);
                System.out.println(AccountName);
                administrativeRequests.remove(option);
                administrativeRequestFull.remove(option);
                administrativeRequestID.remove(option);
                administrativeRequestKeyWord.remove(option);
                administrativeRequestUser.remove(option);
                administrativeRequestedName.remove(option);
                MaintainUserController.updateAccountName(User, AccountName);
            }else {
                MessageHandler.handleMessage(-1, "No Resolutions Available", true);
                AdministrativeMenu();
            }
        }catch(InputMismatchException e){
            MessageHandler.handleMessage(-2, e.toString(), true);
            return false;
        }

        //if(request.contains("Permissions")){

        //}
        return true;
    }

    private static boolean viewAccountList() {
        if(accountRequestNamePool.size() <= 0){
            MessageHandler.handleMessage(-1, "No Account Requests have been made", true);
            return false;
        }else{
            int selection = 0;
            Logo.displayLogo();
            System.out.println("Account creation requests");
            Logo.displayLine();
            for(int i = 0; i > accountRequestNamePool.size(); i++){
                selection++;
                System.out.println(selection + ". " + accountRequestNamePool.get(i));
            }
            try{
                int choice = CustomScanner.nextInt();
                choice -- ;
                MaintainUserController.createNewUser(accountRequestNamePool.get(choice));
                return true;
            }catch(InputMismatchException e){
                MessageHandler.handleMessage(-2, e.toString(), true);
                viewAccountList();
            }
            return true;
        }
    }

    private static boolean enableAnAccount() { 
        Logo.displayLogo();
        System.out.println("Enable An Account");
        Logo.displayLine();
        System.out.println("Target Account: ");
        String Account = CustomScanner.nextLine();
        MessageHandler.handleMessage(1, Account + " was enabled", false);
        if(UserListController.SearchForUser(Account) == true){
            LoginUserController.setValue(Account, "Account", "Enabled");
            MessageHandler.handleMessage(1, "User: " + SecondaryUserController.getUserProp("Username") + " Account was Enabled", true);
            LoginUserController.setValue(Account, "PassFlag", "true");
        }else{
            MessageHandler.handleMessage(-1, "Unable to find user [" + Account + "]", true);
        }
        AdministrativeMenu();
        return true;
    }

    public static boolean enableAdminAccount() {
        if(UserListController.SearchForUser("Admin")){
            LoginUserController.setValue("Admin", "Account", "Enabled");
            MessageHandler.handleMessage(1, "User: " + "Admin" + " Account was Enabled", true);
            LoginUserController.setValue("Admin", "PassFlag", "true");
            return true;
        }else{
            MessageHandler.handleMessage(-1, "Unable to find user [" + "Admin" + "]", true);
            return false;
        }
    }

    private static boolean disableAnAccount() {
        Logo.displayLogo();
        System.out.println("Disable An Account");
        Logo.displayLine();
        System.out.println("Target Account: ");
        String Account = CustomScanner.nextLine();
        MessageHandler.handleMessage(1, Account + " was disabled", false);
        if(UserListController.SearchForUser(Account)){
            if(!Account.equals("Admin")){
                LoginUserController.setValue(Account, "Account", "Disabled");
                MessageHandler.handleMessage(1, "User: " + LoginUserController.getProperty(Account, "Username") + " Account was Disabled", true);
                return true;
            }else {
            	MessageHandler.handleMessage(-1, "CANNOT Disable Admin Account", true);
            	return false;
            }
        }else{
            MessageHandler.handleMessage(-1, "Unable to find user [" + Account + "]", true);
            return false;
        }
    }

    public static boolean newRequest(String focusUser, String request, String Description, String NewAccountName){
        int RequestID = RequestIDGenerator();
        administrativeRequestedName.add(NewAccountName);
        administrativeRequestID.add(RequestID);
        administrativeRequestUser.add(focusUser);
        administrativeRequestKeyWord.add(request);
        administrativeRequests.add(Description);
        administrativeRequestFull.add("[" + focusUser + "] is requesting [" + request + "]...Full Description: " + Description + "[Request ID: " + RequestID + "]");
        MessageHandler.handleMessage(1, "Request saved successfully, an Administrator will review the request as soon as possible. [Request ID: " + RequestID + "]", true);
        return true;
    }

    private static int RequestIDGenerator() {
        Random gen = new Random();
        return gen.nextInt(99999);
    }

    public static boolean removeRequest(){
        return true;
    }
}
